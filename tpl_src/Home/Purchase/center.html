<!DOCTYPE html>  
<html lang="zh-cn">  
<head>  
    <meta charset="UTF-8">  
    <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1, user-scalable=no">  
    <title>功能中心</title>  
    <link rel="stylesheet" href="__PUBLIC_CSS__/bootstrap.min.css" />
    <style type="text/css">
    	*{margin: 0;padding: 0;}
			ul,li{list-style:none;padding: 0;margin: 0;}
			a{ 
				text-decoration:none; 
				color:#333; 
			}
		a:hover{text-decoration:none; }
    	.main{width:100%;height: auto;margin:auto ;background-image: url(__PUBLIC_IMAGE__/bg.png);background-size:100%;clear: both;}
    	
    	.head{width: 92%;text-align: center;margin-left: 4%;}
    	.head>span{height: 60px;width: 100%; line-height: 60px;font-size: 40px;display: block;text-align: center;color: #fff;padding-top: 15px;font-weight: normal;}
	    .head>span:hover{cursor:pointer;}
	    .head>span>sup{font-size:12px;top: -1.7em;}
	    .head>p{display: block;width: 100%;height: 30px;line-height:30px;text-align: center;color: #fff;font-size: 16px;margin-top:15px;}
	    .head>img{width:96% ; border-radius: 10px;}
    	
		.links{width:92%;height: auto;padding: 0;margin-left: 4%;margin-top: 10px;clear: both;}
		.links>li{width: 46%;display: block;float: left;background-color: #fff;margin-left: 2%; margin-right: 2%;text-align: center;margin-bottom: 10px; background-color: #fff;border-radius: 5px;}
		.links>li>img{width:55px;display: block;margin: auto;margin-top: 5px;}
		.links>li>div{width:100%;height: 40px; line-height: 40px;display: block;float: left;}
		.links>li>div>a{width: 90px;height: 30px;line-height: 30px;display: block;color: #118bfa;border-radius: 15px;border: 1px solid #118bfa;margin: auto;margin-top: 5px;}
		#usereg{width: 96%;height: auto;margin-left: 2%;margin-bottom: 10px;display: none;}
		#usereg>img{width: 100%;height: auto;border-radius: 10px;}
		
    	.commonHead{width:100%;position: fixed;top: 0;left: 0;z-index: 20;}
    	@media screen and (min-width:1200px) {
			.main{width: 1200px;}
		}
    </style>
</head>  
<body >  
    <div class="main">
    	<div class="head" >
    		<span>HAPYLIFE<sup>TM</sup></span>
    		<p>{$Think.session.user.username},您好!</p>
    		<img src="__PUBLIC_IMAGE__/好消息.jpg"/>
    	</div>
    	
		<ul class="links">
			<div id="usereg"  onclick='useregCoupon();'>
				<img src="__PUBLIC_IMAGE__/有券注册.png"/>
			</div>
			<li onclick='window.location.href="{:U('Home/Purchase/purchase')}";'>
				<img src="__PUBLIC_IMAGE__/购买产品.png"/>
				<div>
					<a style="color: #ff8b9a;border: 1px solid #ff8b9a;" href="{:U('Home/Purchase/purchase')}">购买礼包</a>
				</div>
			</li>
			<li onclick='window.location.href="{:U('Home/Purchase/dtPurchase')}";'>
				<img src="__PUBLIC_IMAGE__/shop.png"/>
				<div>
					<a style="color: #7950df;border: 1px solid #7950df;" href="{:U('Home/Purchase/dtPurchase')}">商店</a>
				</div>
			</li>
			<li onclick='window.location.href="{:U('Home/Purchase/myOrder')}";'>
				<img src="__PUBLIC_IMAGE__/订单.png"/>
				<div>
					<a style="color: #ffc574;border: 1px solid #ffc574;" href="{:U('Home/Purchase/myOrder')}">订单</a>
				</div>
			</li>
			<li onclick='window.location.href="{:U('Home/Register/new_register')}";'>
				<img src="__PUBLIC_IMAGE__/注册.png"/>
				<div>
					<a style="color: #44f492;border: 1px solid #44f492;" href="{:U('Home/Register/new_register')}">新会员注册</a>
				</div>
			</li>
			<li onclick='window.location.href="{:U('Home/Purchase/addressList')}";'>
				<img src="__PUBLIC_IMAGE__/地址.png"/>
				<div>
					<a style="color: #737aff;border: 1px solid #737aff;" href="{:U('Home/Purchase/addressList')}">地址管理</a>
				</div>
			</li>
			<li onclick='window.location.href="{:U('Home/Purchase/myQrcode')}";'>
				<img src="__PUBLIC_IMAGE__/qrcode.png"/>
				<div>
					<a style="color: #3f3f3f;border: 1px solid #3f3f3f;" href="{:U('Home/Purchase/myQrcode')}">我的二维码</a>
				</div>
			</li>
			<li onclick='window.location.href="{:U('Home/Pay/toCheckPassword')}";'>
				<img src="__PUBLIC_IMAGE__/积分.png"/>
				<div>
					<a style="color: #f2643f;border: 1px solid #f2643f;" href="{:U('Home/Pay/toCheckPassword')}">EP积分</a>
				</div>
			</li>
			<li onclick='window.location.href="{:U('Home/DTPoint/myDTPoint')}";'>
				<img src="__PUBLIC_IMAGE__/DT积分.png"/>
				<div>
					<a style="color: #bc32ff;border: 1px solid #bc32ff;" href="{:U('Home/DTPoint/myDTPoint')}">DT积分</a>
				</div>
			</li>
			
			<input type="hidden" name="username" value="{$Think.session.user.username}">
			<input type="hidden" name="userid" value="{$Think.session.user.id}">
			<input type="hidden" name="cu_id" value="">
			<li onclick='tocoupon();'}>
				<img src="__PUBLIC_IMAGE__/通用券.png"/>
				<div>
					<a style="color: #3ed3f2;border: 1px solid #3ed3f2;" onclick="tocoupon()">通用券</a>
				</div>
			</li>
			<li onclick='window.location.href="{:U('Home/Purchase/bankList')}";'>
				<img src="__PUBLIC_IMAGE__/银行卡.png"/>
				<div>
					<a style="color: #9e7fff;border: 1px solid #9e7fff;" href="{:U('Home/Purchase/bankList')}">银行管理</a>
				</div>
			</li>
			<li onclick='window.location.href="{:U('Home/Purchase/recommenderList')}";'>
				<img src="__PUBLIC_IMAGE__/推荐.png"/>
				<div>
					<a style="color: #ff64c7;border: 1px solid #ff64c7;" href="{:U('Home/Purchase/recommenderList')}">推荐</a>
				</div>
			</li>
			<li onclick='window.location.href="{:U('Home/FeedBack/feedbackList')}";'>
				<img src="__PUBLIC_IMAGE__/意见反馈.png"/>
				<div>
					<a style="color: #2cb7ef;border: 1px solid #2cb7ef;" href="{:U('Home/FeedBack/feedbackList')}">意见反馈</a>
				</div>
			</li>
			<li onclick='window.location.href="{:U('Home/Purchase/myProfile')}";'>
				<img src="__PUBLIC_IMAGE__/资料.png"/>
				<div>
					<a style="color: #f7674d;border: 1px solid #f7674d;" href="{:U('Home/Purchase/myProfile')}">个人资料</a>
				</div>
			</li>
			<li onclick='window.location.href="{:U('Home/Change/changePassword')}";'>
				<img src="__PUBLIC_IMAGE__/修改密码.png"/>
				<div>
					<a style="color: #2cb7ef;border: 1px solid #2cb7ef;" href="{:U('Home/Change/changePassword')}">修改密码</a>
				</div>
			</li>
			<li onclick='window.location.href="{:U('Home/index/log_out')}";'>
				<img src="__PUBLIC_IMAGE__/退出.png"/>
				<div>
					<a style="color: #ff566a;border: 1px solid #ff566a;" href="{:U('Home/index/log_out')}">退出登录</a>
				</div>
			</li>
			<div style="clear: both;"></div>
		</ul>
    	
		
    </div>  
    
	<script src="__PUBLIC_BOOTSTRAP__/js/jquery-1.11.0.min.js"></script>
	<script src="__PUBLIC_BOOTSTRAP__/js/bootstrap.min.js"></script>
	<script src='//cdn.bootcss.com/socket.io/1.3.7/socket.io.js'></script> 
	<script type="text/javascript"> 
	

	getRegistbycoupon();
	
    function tocoupon(){
    	var username=$("input[name='username']").val();
    	var isApp=200;
    	window.location.href="http://apps.nulifeshop.com/nulife/index.php/Home/Coupon/coupons/hu_nickname/"+username+"/whichApp/"+5+"/isApp/"+isApp+"";
//  	window.location.href="http://localhost/testnulife/index.php/Home/Coupon/coupons/hu_nickname/"+username+"/whichApp/"+5+"/isApp/"+isApp+"";
    }
    
	//检查用户券状态
	var socket = io('http://120.77.206.79:2120');
	// uid 可以为网站用户的uid，作为例子这里用customerId代替
	// var uid = $("input[name='username']").val();
	var uid = $("input[name='username']").val();
	//console.log(uid);
	// console.log(sessionId);
	// 当socket连接后发送登录请求
	socket.on('connect', function(){socket.emit('login', uid);});
	// 更新在线人数
	// socket.on('update_online_count',function(online_count){alert(online_count);});
	// 当服务端推送来消息时触发，这里简单的alert出来，用户可做成自己的展示效果
	socket.on('new_msg', function(msg){
		// alert(msg);
		// $("#usereg").css('display','block');
		getRegistbycoupon();
	});	
		
	function useregCoupon(){
		var cu_id=$("input[name='cu_id']").val();
		$.ajax({
			type:"post",
			url:"{:U('Home/Register/hadCoupon')}",
			async:true, 
			dataType: 'json',
			data:{
				cu_id:cu_id
			},
			success:function(ret){
				if(ret.status==1){
					alert('使用成功!');
					$("#usereg").css('display','none');
				}else{
					alert('使用失败!');
				}
			},
			error:function(){
//						alert('接口错误！！!');
			}
		});
	}
	function getRegistbycoupon(){
		var hu_nickname=$("input[name='username']").val();
		$.ajax({
			type:"post",
			url:"{:U('Api/HapylifeCoupon/checkCoupon')}",
			async:true, 
			dataType: 'json',
			data:{
				hu_nickname:hu_nickname,
			},
			success:function(ret){
				if(ret.status==1){
					$("input[name='cu_id']").val(ret.cu_id);
					$("#usereg").css('display','block');
				}else{
					$("#usereg").css('display','none');
				}
			},
			error:function(){
//						alert('接口错误！！!');
			}
		});
	}
	
     
     
	</script>  
</body>  
</html>  