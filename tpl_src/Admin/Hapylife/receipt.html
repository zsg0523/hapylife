<extend name="Public:base" />

<block name="title">订单管理</block>
<block name="content">
    <!-- 导航栏开始 -->
    <div class="page-header">
        <h1>
            物流管理
            &gt;
			订单管理
        </h1>
    </div>
    <div class="col-xs-12">
        <div class="tabbable">
            <ul class="nav nav-tabs padding-12 tab-color-blue background-blue" id="myTab">
            	<li class="active">
					<a href="#home" data-toggle="tab">订单列表</a>
			    </li>
			    <li>
					<a href="javascript:;" pId="{$cid}" lId="{$lid}" fieldTitle="" optionA="" optionB="" optionC="" optionD="" onclick="adds(this)">批量添加</a>
				</li>
            </ul>
		</div>
            <div class="tab-content">
				<table class="table table-striped table-bordered table-hover table-condensed">
					<form action="{:U('Admin/Hapylife/receipt')}" method="get">
						<if condition="$_SESSION['user']['username'] eq mary || $_SESSION['user']['username'] eq admin2">
							<tr>
								<th><input type="text" name="ir_receiptnum" placeholder="订单编号" value="{$ir_receiptnum}"></th>
								<th><input type="text" name="customerid" placeholder="会员账号" value="{$customerid}"></th>
								<th style="width: 88px;"><input type="text" name="lastname" placeholder="姓" value="{$lastname}"></th>
								<th style="width: 88px;"><input type="text" name="firstname" placeholder="名" value="{$firstname}"></th>
								<th><input type="text" name="ir_price" placeholder="订单总金额" value="{$ir_price}"></th>
								<th><input type="text" name="ir_unpaid" placeholder="订单未支付金额" value="{$ir_unpaid}"></th>
								<th>
									<select name="status">
						    			<option <?php if($status == 0)echo "selected";?>  value="0">所有</option>
						    			<option <?php if($status == 1)echo "selected";?>  value="1">待付款</option>
						    			<option <?php if($status == 203)echo "selected";?>  value="203">未全额支付</option>
						    			<option <?php if($status == 3)echo "selected";?>  value="3">已支付</option>
						    			<option <?php if($status == 4)echo "selected";?>  value="4">已发货</option>
						    		</select>
								</th>
								<th>
									<select name="timeType">
						    			<option <?php if($timeType == 'ir_paytime')echo "selected";?> value="ir_paytime">支付时间</option>
						    			<option <?php if($timeType == 'ir_date')echo "selected";?> value="ir_date" >创建时间</option>
						    		</select>
								</th>
								<th colspan="4">
									<input id="start_time" type="text" class="Wdate WdateSearch" style="height:28px;float: left;width: 50%;" value="{$starttime}" name="starttime" onFocus="WdatePicker({dateFmt:'yyyy-MM-dd'})" autocomplete="off" />
				    				<input id="end_time" type="text" class="Wdate WdateSearch" style="height:28px;width: 50%;" value="{$endtime}" name="endtime" onFocus="WdatePicker({dateFmt:'yyyy-MM-dd'})" autocomplete="off"/>
								</th>
								<th><input class='btn btn-sm' type="submit" name='excel' value="excel" /></th>
								<th><input class='btn btn-sm' type="submit" value="筛选" /></th>
							</tr>
							<tr>
								<th >订单编号</th>
								<th >会员账号</th>
								<th >姓</th>
								<th >名</th>
		                        <th >订单总金额</th>
		                        <th >订单未支付金额</th>
		                        <th >订单备注</th>
		                        <th >订单状态</th>
		                        <th >收货人</th>
		                        <th >收货电话</th>
		                        <th >收货地址</th>
		                        <th >创建日期</th>
		                        <th >支付日期</th>
		                        <th >操作</th>
							</tr>
						<else />
							<tr>
								<th><input type="text" name="ir_receiptnum" placeholder="订单编号" value="{$ir_receiptnum}"></th>
								<th><input type="text" name="customerid" placeholder="会员账号" value="{$customerid}"></th>
								<th><input style="width: 88px;" type="text" name="lastname" placeholder="姓" value="{$lastname}"></th>
								<th><input style="width: 88px;" type="text" name="firstname" placeholder="名" value="{$firstname}"></th>
								<th><input style="width: 88px;" type="text" name="ir_price" placeholder="订单总金额" value="{$ir_price}"></th>
								<th><input style="width: 120px;" type="text" name="ir_unpaid" placeholder="订单未支付金额" value="{$ir_unpaid}"></th>
								<th></th>
								<th>
									<select name="status">
						    			<option <?php if($status == 0)echo "selected";?>  value="0">所有</option>
						    			<option <?php if($status == 1)echo "selected";?>  value="1">待付款</option>
						    			<option <?php if($status == 203)echo "selected";?>  value="203">未全额支付</option>
						    			<option <?php if($status == 3)echo "selected";?>  value="3">已支付</option>
						    			<option <?php if($status == 4)echo "selected";?>  value="4">已发货</option>
						    		</select>
								</th>
								<th>
									<select name="timeType">
						    			<option <?php if($timeType == 'ir_paytime')echo "selected";?> value="ir_paytime">支付时间</option>
						    			<option <?php if($timeType == 'ir_date')echo "selected";?> value="ir_date" >创建时间</option>
						    		</select>
								</th>
								<th style="width: 50%;" colspan="4">
									<input id="start_time" type="text" class="Wdate WdateSearch" style="height:28px;float: left;width: 50%;" value="{$starttime}" name="starttime" onFocus="WdatePicker({dateFmt:'yyyy-MM-dd'})" autocomplete="off" />
				    				<input id="end_time" type="text" class="Wdate WdateSearch" style="height:28px;width: 50%;" value="{$endtime}" name="endtime" onFocus="WdatePicker({dateFmt:'yyyy-MM-dd'})" autocomplete="off"/>
								</th>
								<th><input class='btn btn-sm' type="submit" name='excel' value="excel" /></th>
								<th colspan="2"><input class='btn btn-sm' type="submit" value="筛选" /></th>
							</tr>
							<tr>
								<th >订单编号</th>
								<th >会员账号</th>
								<th >姓</th>
								<th >名</th>
		                        <th >订单总金额</th>
		                        <th >订单未支付金额</th>
		                        <th >订单备注</th>
		                        <th >订单状态</th>
		                        <th >收货人</th>
		                        <th >收货电话</th>
		                        <th >收货地址</th>
		                        <th >创建日期</th>
		                        <th >支付日期</th>
		                        <th >查看明细</th>
		                        <th >修改送货地址</th>
								<th >操作</th>
							</tr>
						</if>
						<foreach name="data" item="v">
							<tr>
								<td>{$v['ir_receiptnum']}</td>
								<td>{$v['customerid']}</td>
								<td>{$v['lastname']}</td>
								<td>{$v['firstname']}</td>
								<td>{$v['ir_price']}</td>
								<td>{$v['ir_unpaid']}</td>
								<td>{$v['ir_desc']}</td>
								<td>
									<if condition="$v['ir_status'] eq 2">已支付
	                                <elseif condition="$v['ir_status'] eq 3"/>已发货
	                                <elseif condition="$v['ir_status'] eq 4"/>已送达
	                                <elseif condition="$v['ir_status'] eq 5"/>申请退货
	                                <elseif condition="$v['ir_status'] eq 7 || $v['ir_status'] eq 0"/>待付款
	                                <elseif condition="$v['ir_status'] eq 8"/>已退货
	                                <elseif condition="$v['ir_status'] eq 202"/>未全额支付
	                                </if>
								</td>
								<td>{$v['ia_name']}</td>
								<td>{$v['ia_phone']}</td>
								<td style="">{$v['ia_province']}{$v['ia_city']}{$v['ia_area']}{$v['ia_address']}</td>
								<td>{:date('Y-m-d H:i:s',$v['ir_date'])}</td>
								<td>
									<if condition="$v['ir_paytime'] eq 0">
									<else/>{:date('Y-m-d H:i:s',$v['ir_paytime'])}
									</if>
								</td>
								<td><a href="{:U('Admin/Hapylife/receiptSon',array('ir_receiptnum'=>$v['ir_receiptnum']))}">查看明细</a></td>
								<td>
									<a href="javascript:;" receiptId="{$v['irid']}" receiptNum="{$v['ir_receiptnum']}" receiptPrice="{$v[ir_price]}" receiptUser="{$v['rcustomerid']}" ianame="{$v[ia_name]}" receiptPhone="{$v[ia_phone]}" iaprovince="{$v['ia_province']}" iacity="{$v['ia_city']}" iaarea="{$v['ia_area']}" receiptAddress="{$v['ia_address']}" onclick="editAddress(this)">修改收货地址</a>
								</td>
								<if condition="$_SESSION['user']['username'] eq mary || $_SESSION['user']['username'] eq admin2">
								<else />
									<td>
										<a href="javascript:if(confirm('确定删除{$v['customerid']}的订单？'))location='{:U('Admin/Hapylife/delete_receipt',array('id'=>$v['irid']))}'">删除</a> 
									</td>
								</if>
							</tr>
						</foreach>
					</form>
				</table>
				<div class='page'>
					{$page}
				</div>
            </div>
        </div>
    </div>

	<!-- 添加菜单模态框开始 -->
	<div class="modal fade" id="bjy-adds" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			 <div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
						&times;
					</button>
					<h4 class="modal-title" id="myModalLabel">
						批量添加
					</h4>
				</div>
				<div class="modal-body">
					<form id="bjy-form" class="form-inline" action="{:U('Admin/Hapylife/add_receipt')}" method="post" enctype="multipart/form-data">
						<table class="table table-striped table-bordered table-hover table-condensed">
							<tr>
								<th width="15%">示例文件</th>
								<td>
									<a href="http://apps.hapy-life.com/hapylife/simple.xlsx" download="simple.xlsx">下载</a>
								</td>
							</tr>
							<tr>
								<th width="15%">文件</th>
								<td>
									<input class="input-medium" type="file" name="file">
								</td>
							</tr>
							<tr>
								<th></th>
								<td>
									<input class="btn btn-success" type="submit" value="添加">
								</td>
							</tr>
						</table>
					</form>
				</div>
			</div>
		</div>
	</div>
	<!-- 添加菜单模态框结束 -->

	<!-- 修改收货人信息模态框开始 -->
	<div class="modal fade" id="bjy-editAddress" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			 <div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
						&times;
					</button>
					<h4 class="modal-title" id="myModalLabel">
						修改收货人信息
					</h4>
				</div>
				<div class="modal-body">
					<form id="bjy-form" class="form-inline" action="{:U('Admin/Hapylife/editReceiptAddress')}" method="post">
						<input type="hidden" name="id">
						<table class="table table-striped table-bordered table-hover table-condensed">
							<tr>
								<th width="15%">编号：</th>
								<td id='Receiptnum'></td>
							</tr>
							<tr>
                            <th>会员：</th>
                            <td id='Receiptuser'></td>
                        </tr>
                        <tr>
                            <th>金额：</th>
                            <td id='Receiptprice'></td>
                        </tr>
                            <tr>
                                <th>收货人信息：</th>
                                <td>
                                    姓&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;名:&nbsp;<input type="text" name="ia_name"  size="50" class="inpMain" /><br/>
                                    <p></p>
                                    电&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;话:&nbsp;<input type="text" name="ia_phone"  size="50" class="inpMain" /><br/>
                                    <p></p>
                                    省&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;<input type="text" name="ia_province"  size="50" class="inpMain" /><br/>
                                    <p></p>
                                    市&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;<input type="text" name="ia_city"  size="50" class="inpMain" /><br/>
                                    <p></p>
                                    区/县&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:&nbsp;<input type="text" name="ia_area"  size="50" class="inpMain" /><br/>
                                    <p></p>
                                    详细地址&nbsp;:&nbsp;<input type="text" name="ia_address"  size="50" class="inpMain" />
                                </td>
                            </tr>
						<tr>
							<th></th>
							<td>
								<input class="btn btn-success" type="submit" value="修改">
							</td>
						</tr>
						</table>
					</form>
				</div>
			</div>
		</div>
	</div>
	<!-- 修改收货人信息模态框结束 -->
</block>
<block name="js">
	<script>
	// 添加菜单
	function add(){
		$("input[name='title']").val('');
		$('#bjy-add').modal('show');
	}

	// 批量添加
	function adds(){
		$('#bjy-adds').modal('show');
	}

	// 修改收货单地址
	function editAddress(obj){
		var receiptId          =$(obj).attr('receiptId');
		var receiptNum         =$(obj).attr('receiptNum');
		var receiptPrice       =$(obj).attr('receiptPrice');
		var receiptUser        =$(obj).attr('receiptUser');
		var receiptPhone       =$(obj).attr('receiptPhone');
		var receiptAddress     =$(obj).attr('receiptAddress');
		var ianame             =$(obj).attr('ianame');
		var iaprovince         =$(obj).attr('iaprovince');
		var iacity             =$(obj).attr('iacity');
		var iaarea             =$(obj).attr('iaarea');
		Receiptnum.innerText   =receiptNum;
		Receiptuser.innerText  =receiptUser;
		Receiptprice.innerText =receiptPrice;
		$("input[name='id']").val(receiptId);
		$("input[name='ia_name']").val(ianame);
		$("input[name='ia_province']").val(iaprovince);
		$("input[name='ia_city']").val(iacity);
		$("input[name='ia_area']").val(iaarea);
		$("input[name='ia_phone']").val(receiptPhone);
		$("input[name='ia_address']").val(receiptAddress);
		$('#bjy-editAddress').modal('show');
	}

	</script>
</block>